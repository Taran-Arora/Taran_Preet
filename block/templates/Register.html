<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="/css/login.css" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider@1.2.0/dist/detect-provider.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
</head>
<body>
  <section class="body-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="login-section">
            <div class="login-start">
              <div class="log-heading">
                <!-- <img class="head-pic" src="./images/logo1.png"> -->
                <h2>Register</h2>
              </div>
              <form id="register-form">
                <div class="form-details">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Sponser ID"
                    id="sponser-id"
                  />
                  <span><i class="fa-solid fa-id-card"></i></span>
                </div>
                <div class="form-details">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Address"
                    id="address"
                    required
                    readonly
                  />
                  <span><i class="fa-regular fa-address-book"></i></span>
                </div>
                <div class="form-details">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="First Name"
                    id="first-name"
                    required
                  />
                  <span><i class="fa-solid fa-user"></i></span>
                </div>
                <div class="form-details">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Last Name"
                    id="last-name"
                    required
                  />
                  <span><i class="fa-solid fa-user"></i></span>
                </div>
                <button type="submit" class="log-btn">Register</button>
                <div class="form-para h-acc">
                  <a href="/" class="signup">Login</a>
                  Already have an account?
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    $(document).ready(function () {
      $('#address').click(async function () {
        try {
          const provider = await detectEthereumProvider();
          if (provider) {
            const accounts = await provider.request({ method: 'eth_requestAccounts' });
            $('#address').val(accounts[0]);
          } else {
            toastr.error('MetaMask not detected. Please install MetaMask and try again.');
          }
        } catch (error) {
          console.error(error);
          toastr.error('An error occurred while connecting to MetaMask.');
        }
      });

      $('#register-form').submit(function (e) {
        e.preventDefault();
        const sponserId = $('#sponser-id').val();
        const address = $('#address').val();
        const firstName = $('#first-name').val();
        const lastName = $('#last-name').val();

        const formData = {
          sponserId: sponserId,
          address: address,
          firstName: firstName,
          lastName: lastName,
        };

        $.ajax({
          url: '/api/register',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(formData),
          success: function (response) {
            toastr.success('Registration successful!', response);
            // window.location.href = '/';
          },
          error: function (xhr, status, error) {
            console.error(error);
            toastr.error('An error occurred during registration: ' + error);
          }
        });
      });
    });
  </script>
</body>
</html>
